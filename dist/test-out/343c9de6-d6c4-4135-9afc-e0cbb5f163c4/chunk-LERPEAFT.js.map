{
  "version": 3,
  "sources": ["src/app/services/loto-state.service.ts"],
  "sourcesContent": ["import { Injectable, NgZone, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\n\r\nexport interface LotoState {\r\n  partyNumber: number;\r\n  partyType: string;\r\n  lastNumber: number | null;\r\n  selectedNumbers: number[];\r\n}\r\n\r\nconst INITIAL_STATE: LotoState = {\r\n  partyNumber: 0,\r\n  partyType: '',\r\n  lastNumber: null,\r\n  selectedNumbers: [],\r\n};\r\n\r\nconst CHANNEL_NAME = 'easy_loto_channel';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class LotoStateService implements OnDestroy {\r\n  private state: LotoState = { ...INITIAL_STATE };\r\n  private stateSubject = new BehaviorSubject<LotoState>(this.state);\r\n  private channel: BroadcastChannel;\r\n\r\n  state$: Observable<LotoState> = this.stateSubject.asObservable();\r\n\r\n  constructor(private ngZone: NgZone) {\r\n    this.channel = new BroadcastChannel(CHANNEL_NAME);\r\n    this.channel.onmessage = (event: MessageEvent<LotoState>) => {\r\n      this.ngZone.run(() => {\r\n        this.state = event.data;\r\n        this.stateSubject.next(this.state);\r\n      });\r\n    };\r\n  }\r\n\r\n  updateParty(partyNumber: number, partyType: string): void {\r\n    this.state = { ...this.state, partyNumber, partyType };\r\n    this.broadcast();\r\n  }\r\n\r\n  startNewParty(partyNumber: number): void {\r\n    this.state = { partyNumber, partyType: '', lastNumber: null, selectedNumbers: [] };\r\n    this.broadcast();\r\n  }\r\n\r\n  updateNumbers(selectedNumbers: number[], lastNumber: number | null): void {\r\n    this.state = { ...this.state, selectedNumbers, lastNumber };\r\n    this.broadcast();\r\n  }\r\n\r\n  resetNumbers(): void {\r\n    this.state = { ...this.state, selectedNumbers: [], lastNumber: null };\r\n    this.broadcast();\r\n  }\r\n\r\n  getState(): LotoState {\r\n    return this.state;\r\n  }\r\n\r\n  private broadcast(): void {\r\n    this.stateSubject.next(this.state);\r\n    this.channel.postMessage(this.state);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.channel.close();\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;IAUM,eAOA,cAKO;;;;;AAtBb;AACA;AASA,IAAM,gBAA2B;MAC/B,aAAa;MACb,WAAW;MACX,YAAY;MACZ,iBAAiB,CAAA;;AAGnB,IAAM,eAAe;AAKd,IAAM,mBAAN,MAAMA,kBAAgB;MAO3B,YAAoB,QAAc;AAAd,aAAA,SAAA;AANZ,aAAA,QAAmB,mBAAK;AACxB,aAAA,eAAe,IAAI,gBAA2B,KAAK,KAAK;AAGhE,aAAA,SAAgC,KAAK,aAAa,aAAY;AAG5D,aAAK,UAAU,IAAI,iBAAiB,YAAY;AAChD,aAAK,QAAQ,YAAY,CAAC,UAAkC;AAC1D,eAAK,OAAO,IAAI,MAAK;AACnB,iBAAK,QAAQ,MAAM;AACnB,iBAAK,aAAa,KAAK,KAAK,KAAK;UACnC,CAAC;QACH;MACF;MAEA,YAAY,aAAqB,WAAiB;AAChD,aAAK,QAAQ,iCAAK,KAAK,QAAV,EAAiB,aAAa,UAAS;AACpD,aAAK,UAAS;MAChB;MAEA,cAAc,aAAmB;AAC/B,aAAK,QAAQ,EAAE,aAAa,WAAW,IAAI,YAAY,MAAM,iBAAiB,CAAA,EAAE;AAChF,aAAK,UAAS;MAChB;MAEA,cAAc,iBAA2B,YAAyB;AAChE,aAAK,QAAQ,iCAAK,KAAK,QAAV,EAAiB,iBAAiB,WAAU;AACzD,aAAK,UAAS;MAChB;MAEA,eAAY;AACV,aAAK,QAAQ,iCAAK,KAAK,QAAV,EAAiB,iBAAiB,CAAA,GAAI,YAAY,KAAI;AACnE,aAAK,UAAS;MAChB;MAEA,WAAQ;AACN,eAAO,KAAK;MACd;MAEQ,YAAS;AACf,aAAK,aAAa,KAAK,KAAK,KAAK;AACjC,aAAK,QAAQ,YAAY,KAAK,KAAK;MACrC;MAEA,cAAW;AACT,aAAK,QAAQ,MAAK;MACpB;;;;;;;AAhDW,uBAAgB,WAAA;MAH5B,WAAW;QACV,YAAY;OACb;OACY,gBAAgB;;;",
  "names": ["LotoStateService"]
}
